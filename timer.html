<html>

<head>
</head>

<body>
    volume
<input type="range" id="vIn" value="30" min="0" max="100" oninput="show()" />
<span id="vOut"></span><br>
duration
<input type="range" id="dIn" value="700" min="1" max="5000" oninput="show()" />
<span id="dOut"></span><br>
interval
<input type="range" id="intervalIn"  value="15" min="5" max="60" oninput="show()" />
<span id="intervalOut"></span>
<br>
<div id="timerState"></div>
<br>

<button id="toggleButton" onclick='startTimer();'>Start Timer</button>
<!-- <button onclick='stopTimer();'>Stop Timer</button> -->

    <script>
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        var volume = 0.2;
        var duration = 400;
        var intervalSeconds;
        var intervalId;
        var isTimerRunning = false;

        show();

        function show() {
            volume = document.getElementById("vIn").value / 100;
            document.getElementById("vOut").innerHTML = volume;

            duration = document.getElementById("dIn").value;
            document.getElementById("dOut").innerHTML = duration + ' ms';

            intervalSeconds = document.getElementById("intervalIn").value;
            document.getElementById("intervalOut").innerHTML = intervalSeconds + ' seconds';

            if(isTimerRunning) {
                document.getElementById("timerState").innerHTML = "Timer Started";
                document.getElementById("toggleButton").innerHTML = "Stop Timer";
            } else {
                document.getElementById("timerState").innerHTML = "Timer Stopped";
                document.getElementById("toggleButton").innerHTML = "Start Timer";
            }
        }
        
        function startTimer() {
            if(intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }

            if (isTimerRunning) {
                isTimerRunning = false;
            } else {
                isTimerRunning = true;
                beep();
    
                intervalId = setInterval(
                    function() {
                        beep();
                    }, intervalSeconds * 1000
                );
            }
            show();
        }

        function stopTimer() {
            clearInterval(intervalId);
        }

        function beep() {
            frequency = 490;
            type = 'triangle';

            var oscillator = audioCtx.createOscillator();
            var gainNode = audioCtx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            gainNode.gain.value = volume;
            oscillator.frequency.value = frequency;
            oscillator.type = type;

            oscillator.start();

            setTimeout(
                function () {
                    oscillator.stop();
                },
                duration
            );
        };
    </script>
</body>

</html>